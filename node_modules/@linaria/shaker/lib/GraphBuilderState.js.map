{"version":3,"file":"GraphBuilderState.js","names":["GraphBuilderState","scope","ScopeManager","graph","DepsGraph","meta","Map","callbacks","context","fnStack","onVisit","callback","push","filter","c"],"sources":["../src/GraphBuilderState.ts"],"sourcesContent":["import type { Node } from '@babel/types';\n\nimport type { VisitorKeys } from '@linaria/babel-preset';\n\nimport DepsGraph from './DepsGraph';\nimport ScopeManager from './scope';\nimport type { VisitorAction } from './types';\n\nexport type OnVisitCallback = (n: Node) => void;\n\nexport default abstract class GraphBuilderState {\n  public readonly scope = new ScopeManager();\n\n  public readonly graph = new DepsGraph(this.scope);\n\n  public readonly meta = new Map<string, unknown>();\n\n  protected callbacks: OnVisitCallback[] = [];\n\n  /*\n   * For expressions like `{ foo: bar }` we need to now context\n   *\n   * const obj = { foo: bar };\n   * Here context is `expression`, `bar` is a variable which depends from its declaration.\n   *\n   * const { foo: bar } = obj;\n   * Here context is `pattern` and `bar` is a variable declaration itself.\n   */\n  public readonly context: Array<'expression' | 'lval'> = [];\n\n  public readonly fnStack: Node[] = [];\n\n  public onVisit(callback: OnVisitCallback) {\n    this.callbacks.push(callback);\n    return () => {\n      this.callbacks = this.callbacks.filter((c) => c !== callback);\n    };\n  }\n\n  abstract baseVisit<TNode extends Node>(\n    node: TNode,\n    ignoreDeps?: boolean\n  ): void;\n\n  abstract visit<TNode extends Node, TParent extends Node>(\n    node: TNode,\n    parent: TParent | null,\n    parentKey: VisitorKeys<TParent> | null,\n    listIdx?: number | null\n  ): VisitorAction;\n}\n"],"mappings":";;;;;;;AAIA;;AACA;;;;AAKe,MAAeA,iBAAf,CAAiC;EAC9BC,KAAK,GAAG,IAAIC,cAAJ,EAAH;EAELC,KAAK,GAAG,IAAIC,kBAAJ,CAAc,KAAKH,KAAnB,CAAH;EAELI,IAAI,GAAG,IAAIC,GAAJ,EAAH;EAEVC,SAAS,GAAsB,EAAtB;EAEnB;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;EACkBC,OAAO,GAAiC,EAAjC;EAEPC,OAAO,GAAW,EAAX;;EAEhBC,OAAO,CAACC,QAAD,EAA4B;IACxC,KAAKJ,SAAL,CAAeK,IAAf,CAAoBD,QAApB;IACA,OAAO,MAAM;MACX,KAAKJ,SAAL,GAAiB,KAAKA,SAAL,CAAeM,MAAf,CAAuBC,CAAD,IAAOA,CAAC,KAAKH,QAAnC,CAAjB;IACD,CAFD;EAGD;;AA3B6C"}