{"version":3,"file":"module.js","names":["fs","NativeModule","path","dirname","vm","debug","EvalCache","process","builtins","assert","buffer","child_process","cluster","console","constants","crypto","dgram","dns","domain","events","http","https","module","net","os","punycode","querystring","readline","repl","stream","string_decoder","sys","timers","tls","tty","url","util","zlib","cache","NOOP","createCustomDebug","depth","_args","namespaces","arg1","args","modulePrefix","cookModuleId","rawId","replace","Module","constructor","filename","options","debuggerDepth","id","imports","paths","dependencies","transform","Object","defineProperties","value","writable","freeze","_nodeModulePaths","exports","extensions","resolve","_extensions","added","forEach","ext","push","_resolveFilename","require","assign","isAbsolute","Error","cacheKey","only","has","get","sort","length","join","m","includes","extname","code","readFileSync","test","JSON","parse","evaluate","ensure","text","matchedRules","rules","filter","RegExp","reverse","action","evaluator","default","name","script","Script","runInContext","createContext","clearImmediate","clearInterval","clearTimeout","setImmediate","setInterval","setTimeout","global","__filename","__dirname","set","invalidate","invalidateEvalCache","clear"],"sources":["../src/module.ts"],"sourcesContent":["/**\n * This is a custom implementation for the module system for evaluating code,\n * used for resolving values for dependencies interpolated in `css` or `styled`.\n *\n * This serves 2 purposes:\n * - Avoid leakage from evaluated code to module cache in current context, e.g. `babel-register`\n * - Allow us to invalidate the module cache without affecting other stuff, necessary for rebuilds\n *\n * We also use it to transpile the code with Babel by default.\n * We also store source maps for it to provide correct error stacktraces.\n *\n */\n\nimport fs from 'fs';\nimport NativeModule from 'module';\nimport path, { dirname } from 'path';\nimport vm from 'vm';\n\nimport type { BabelFileResult } from '@babel/core';\n\nimport { debug } from '@linaria/logger';\n\nimport * as EvalCache from './eval-cache';\nimport * as process from './process';\nimport type { Evaluator, StrictOptions } from './types';\n\n// Supported node builtins based on the modules polyfilled by webpack\n// `true` means module is polyfilled, `false` means module is empty\nconst builtins = {\n  assert: true,\n  buffer: true,\n  child_process: false,\n  cluster: false,\n  console: true,\n  constants: true,\n  crypto: true,\n  dgram: false,\n  dns: false,\n  domain: true,\n  events: true,\n  fs: false,\n  http: true,\n  https: true,\n  module: false,\n  net: false,\n  os: true,\n  path: true,\n  punycode: true,\n  process: true,\n  querystring: true,\n  readline: false,\n  repl: false,\n  stream: true,\n  string_decoder: true,\n  sys: true,\n  timers: true,\n  tls: false,\n  tty: true,\n  url: true,\n  util: true,\n  vm: true,\n  zlib: true,\n};\n\n// Separate cache for evaluated modules\nlet cache: { [id: string]: Module } = {};\n\nconst NOOP = () => {};\n\nconst createCustomDebug =\n  (depth: number) =>\n  (..._args: Parameters<typeof debug>) => {\n    const [namespaces, arg1, ...args] = _args;\n    const modulePrefix = depth === 0 ? 'module' : `sub-module-${depth}`;\n    debug(`${modulePrefix}:${namespaces}`, arg1, ...args);\n  };\n\nconst cookModuleId = (rawId: string) => {\n  // It's a dirty hack for avoiding conflicts with babel-preset-react-app\n  // https://github.com/callstack/linaria/issues/745\n  // FIXME @Anber: I'll try to figure out a better solution. Probably, using Terser as a shaker's core can solve problems with interfered plugins.\n  return rawId.replace(\n    '/@babel/runtime/helpers/esm/',\n    '/@babel/runtime/helpers/'\n  );\n};\n\nclass Module {\n  static invalidate: () => void;\n\n  static invalidateEvalCache: () => void;\n\n  static _resolveFilename: (\n    id: string,\n    options: { id: string; filename: string; paths: string[] }\n  ) => string;\n\n  static _nodeModulePaths: (filename: string) => string[];\n\n  id: string;\n\n  filename: string;\n\n  options: StrictOptions;\n\n  imports: Map<string, string[]> | null;\n\n  paths: string[];\n\n  exports: unknown;\n\n  extensions: string[];\n\n  dependencies: string[] | null;\n\n  transform: ((text: string) => BabelFileResult | null) | null;\n\n  debug: typeof debug;\n\n  debuggerDepth: number;\n\n  constructor(filename: string, options: StrictOptions, debuggerDepth = 0) {\n    this.id = filename;\n    this.filename = filename;\n    this.options = options;\n    this.imports = null;\n    this.paths = [];\n    this.dependencies = null;\n    this.transform = null;\n    this.debug = createCustomDebug(debuggerDepth);\n    this.debuggerDepth = debuggerDepth;\n\n    Object.defineProperties(this, {\n      id: {\n        value: filename,\n        writable: false,\n      },\n      filename: {\n        value: filename,\n        writable: false,\n      },\n      paths: {\n        value: Object.freeze(\n          (\n            NativeModule as unknown as {\n              _nodeModulePaths(filename: string): string[];\n            }\n          )._nodeModulePaths(path.dirname(filename))\n        ),\n        writable: false,\n      },\n    });\n\n    this.exports = {};\n\n    // We support following extensions by default\n    this.extensions = ['.json', '.js', '.jsx', '.ts', '.tsx'];\n    this.debug('prepare', filename);\n  }\n\n  resolve = (rawId: string) => {\n    const id = cookModuleId(rawId);\n    const extensions = (\n      NativeModule as unknown as {\n        _extensions: { [key: string]: () => void };\n      }\n    )._extensions;\n    const added: string[] = [];\n\n    try {\n      // Check for supported extensions\n      this.extensions.forEach((ext) => {\n        if (ext in extensions) {\n          return;\n        }\n\n        // When an extension is not supported, add it\n        // And keep track of it to clean it up after resolving\n        // Use noop for the transform function since we handle it\n        extensions[ext] = NOOP;\n        added.push(ext);\n      });\n\n      return Module._resolveFilename(id, this);\n    } finally {\n      // Cleanup the extensions we added to restore previous behaviour\n      added.forEach((ext) => delete extensions[ext]);\n    }\n  };\n\n  require: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (id: string): any;\n    resolve: (id: string) => string;\n    ensure: () => void;\n    cache: typeof cache;\n  } = Object.assign(\n    (rawId: string) => {\n      const id = cookModuleId(rawId);\n      this.debug('require', id);\n      if (id in builtins) {\n        // The module is in the allowed list of builtin node modules\n        // Ideally we should prevent importing them, but webpack polyfills some\n        // So we check for the list of polyfills to determine which ones to support\n        if (builtins[id as keyof typeof builtins]) {\n          return require(id);\n        }\n\n        return null;\n      }\n\n      // Resolve module id (and filename) relatively to parent module\n      const filename = this.resolve(id);\n      if (filename === id && !path.isAbsolute(id)) {\n        // The module is a builtin node modules, but not in the allowed list\n        throw new Error(\n          `Unable to import \"${id}\". Importing Node builtins is not supported in the sandbox.`\n        );\n      }\n\n      this.dependencies?.push(id);\n\n      let cacheKey = filename;\n      let only: string[] = [];\n      if (this.imports?.has(id)) {\n        // We know what exactly we need from this module. Let's shake it!\n        only = this.imports.get(id)!.sort();\n        if (only.length === 0) {\n          // Probably the module is used as a value itself\n          // like `'The answer is ' + require('./module')`\n          only = ['default'];\n        }\n\n        cacheKey += `:${only.join(',')}`;\n      }\n\n      let m = cache[cacheKey];\n\n      if (!m) {\n        this.debug('cached:not-exist', id);\n        // Create the module if cached module is not available\n        m = new Module(filename, this.options, this.debuggerDepth + 1);\n        m.transform = this.transform;\n\n        // Store it in cache at this point with, otherwise\n        // we would end up in infinite loop with cyclic dependencies\n        cache[cacheKey] = m;\n\n        if (this.extensions.includes(path.extname(filename))) {\n          // To evaluate the file, we need to read it first\n          const code = fs.readFileSync(filename, 'utf-8');\n          if (/\\.json$/.test(filename)) {\n            // For JSON files, parse it to a JS object similar to Node\n            m.exports = JSON.parse(code);\n          } else {\n            // For JS/TS files, evaluate the module\n            // The module will be transpiled using provided transform\n            m.evaluate(code, only.includes('*') ? ['*'] : only);\n          }\n        } else {\n          // For non JS/JSON requires, just export the id\n          // This is to support importing assets in webpack\n          // The module will be resolved by css-loader\n          m.exports = id;\n        }\n      } else {\n        this.debug('cached:exist', id);\n      }\n\n      return m.exports;\n    },\n    {\n      ensure: NOOP,\n      cache,\n      resolve: this.resolve,\n    }\n  );\n\n  evaluate(text: string, only: string[] | null = null) {\n    const { filename } = this;\n    const matchedRules = this.options.rules\n      .filter(({ test }) => {\n        if (!test) {\n          return true;\n        }\n\n        if (typeof test === 'function') {\n          return test(filename);\n        }\n\n        if (test instanceof RegExp) {\n          return test.test(filename);\n        }\n\n        return false;\n      })\n      .reverse();\n\n    const cacheKey = [this.filename, ...(only ?? [])];\n\n    if (EvalCache.has(cacheKey, text)) {\n      this.exports = EvalCache.get(cacheKey, text);\n      return;\n    }\n\n    let code: string | null | undefined;\n    const action = matchedRules.length > 0 ? matchedRules[0].action : 'ignore';\n    if (action === 'ignore') {\n      this.debug('ignore', `${filename}`);\n      code = text;\n    } else {\n      // Action can be a function or a module name\n      const evaluator: Evaluator =\n        typeof action === 'function'\n          ? action\n          : require(require.resolve(action, {\n              paths: [dirname(this.filename)],\n            })).default;\n\n      // For JavaScript files, we need to transpile it and to get the exports of the module\n      let imports: Module['imports'];\n\n      this.debug('prepare-evaluation', this.filename, 'using', evaluator.name);\n\n      [code, imports] = evaluator(this.filename, this.options, text, only);\n      this.imports = imports;\n\n      this.debug(\n        'evaluate',\n        `${this.filename} (only ${(only || []).join(', ')}):\\n${code}`\n      );\n    }\n\n    const script = new vm.Script(\n      `(function (exports) { ${code}\\n})(exports);`,\n      {\n        filename: this.filename,\n      }\n    );\n\n    script.runInContext(\n      vm.createContext({\n        clearImmediate: NOOP,\n        clearInterval: NOOP,\n        clearTimeout: NOOP,\n        setImmediate: NOOP,\n        setInterval: NOOP,\n        setTimeout: NOOP,\n        global,\n        process,\n        module: this,\n        exports: this.exports,\n        require: this.require,\n        __filename: this.filename,\n        __dirname: path.dirname(this.filename),\n      })\n    );\n\n    EvalCache.set(cacheKey, text, this.exports);\n  }\n}\n\nModule.invalidate = () => {\n  cache = {};\n};\n\nModule.invalidateEvalCache = () => {\n  EvalCache.clear();\n};\n\n// Alias to resolve the module using node's resolve algorithm\n// This static property can be overriden by the webpack loader\n// This allows us to use webpack's module resolution algorithm\nModule._resolveFilename = (id, options) =>\n  (\n    NativeModule as unknown as {\n      _resolveFilename: typeof Module._resolveFilename;\n    }\n  )._resolveFilename(id, options);\n\nModule._nodeModulePaths = (filename: string) =>\n  (\n    NativeModule as unknown as {\n      _nodeModulePaths: (filename: string) => string[];\n    }\n  )._nodeModulePaths(filename);\n\nexport default Module;\n"],"mappings":"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"}