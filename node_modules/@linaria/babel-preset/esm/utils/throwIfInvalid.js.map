{"version":3,"file":"throwIfInvalid.js","names":["generator","isSerializable","isLikeError","value","throwIfInvalid","ex","Number","isFinite","stack","message","buildCodeFrameError","stringified","JSON","stringify","String","node","code"],"sources":["../../src/utils/throwIfInvalid.ts"],"sourcesContent":["import generator from '@babel/generator';\nimport type { NodePath } from '@babel/traverse';\n\nimport type { Serializable } from '../types';\n\nimport isSerializable from './isSerializable';\n\nconst isLikeError = (value: unknown): value is Error =>\n  typeof value === 'object' &&\n  value !== null &&\n  'stack' in value &&\n  'message' in value;\n\n// Throw if we can't handle the interpolated value\nfunction throwIfInvalid(\n  value: Error | unknown,\n  ex: NodePath\n): asserts value is (() => void) | string | number | Serializable {\n  if (\n    typeof value === 'function' ||\n    typeof value === 'string' ||\n    (typeof value === 'number' && Number.isFinite(value)) ||\n    isSerializable(value)\n  ) {\n    return;\n  }\n\n  // We can't use instanceof here so let's use duck typing\n  if (isLikeError(value) && value.stack && value.message) {\n    throw ex.buildCodeFrameError(\n      `An error occurred when evaluating the expression:\n\n  > ${value.message}.\n\n  Make sure you are not using a browser or Node specific API and all the variables are available in static context.\n  Linaria have to extract pieces of your code to resolve the interpolated values.\n  Defining styled component or class will not work inside:\n    - function,\n    - class,\n    - method,\n    - loop,\n  because it cannot be statically determined in which context you use them.\n  That's why some variables may be not defined during evaluation.\n      `\n    );\n  }\n\n  const stringified =\n    typeof value === 'object' ? JSON.stringify(value) : String(value);\n\n  throw ex.buildCodeFrameError(\n    `The expression evaluated to '${stringified}', which is probably a mistake. If you want it to be inserted into CSS, explicitly cast or transform the value to a string, e.g. - 'String(${\n      generator(ex.node).code\n    })'.`\n  );\n}\n\nexport default throwIfInvalid;\n"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,kBAAtB;AAKA,OAAOC,cAAP,MAA2B,kBAA3B;;AAEA,MAAMC,WAAW,GAAIC,KAAD,IAClB,OAAOA,KAAP,KAAiB,QAAjB,IACAA,KAAK,KAAK,IADV,IAEA,WAAWA,KAFX,IAGA,aAAaA,KAJf,C,CAMA;;;AACA,SAASC,cAAT,CACED,KADF,EAEEE,EAFF,EAGkE;EAChE,IACE,OAAOF,KAAP,KAAiB,UAAjB,IACA,OAAOA,KAAP,KAAiB,QADjB,IAEC,OAAOA,KAAP,KAAiB,QAAjB,IAA6BG,MAAM,CAACC,QAAP,CAAgBJ,KAAhB,CAF9B,IAGAF,cAAc,CAACE,KAAD,CAJhB,EAKE;IACA;EACD,CAR+D,CAUhE;;;EACA,IAAID,WAAW,CAACC,KAAD,CAAX,IAAsBA,KAAK,CAACK,KAA5B,IAAqCL,KAAK,CAACM,OAA/C,EAAwD;IACtD,MAAMJ,EAAE,CAACK,mBAAH,CACH;AACP;AACA,MAAMP,KAAK,CAACM,OAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAdU,CAAN;EAgBD;;EAED,MAAME,WAAW,GACf,OAAOR,KAAP,KAAiB,QAAjB,GAA4BS,IAAI,CAACC,SAAL,CAAeV,KAAf,CAA5B,GAAoDW,MAAM,CAACX,KAAD,CAD5D;EAGA,MAAME,EAAE,CAACK,mBAAH,CACH,gCAA+BC,WAAY,8IAC1CX,SAAS,CAACK,EAAE,CAACU,IAAJ,CAAT,CAAmBC,IACpB,KAHG,CAAN;AAKD;;AAED,eAAeZ,cAAf"}